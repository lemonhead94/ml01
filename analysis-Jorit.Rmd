---
output:
  bookdown::pdf_document2:
    includes:
      in_header: latex/preamble.tex
      before_body: latex/titlepage.tex
    pandoc_args:
    - --csl
    - references/apa.csl
  bookdown::html_document2:
    pandoc_args:
    - --csl
    - references/apa.csl
  bookdown::word_document2:
    pandoc_args:
    - --csl
    - references/apa.csl
toc-title: Table of Contents
bibliography: references/references.bib
link-citations: yes
header-includes:
- \usepackage{fancyhdr}
- \pagestyle{fancy}
- \renewcommand{\headrulewidth}{0pt}
- \fancyfoot[C]{}
- \fancyfoot[R]{\thepage}
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, messages = FALSE)
packages <- c("bookdown", "dplyr", "ggplot2", "papeR", "kableExtra", "mgcv")
package.check <- lapply(packages, FUN = function(x) {
    if (!require(x, character.only = TRUE)) {
        install.packages(x, dependencies = TRUE)
        library(x, character.only = TRUE)
    }
})
```
\fancyhead[LR]{}
\pagenumbering{roman}

\newpage
\cleardoublepage
\pagenumbering{arabic}
\fancyhead[L]{Employee Attrition Model}
\fancyhead[R]{Machine Learning I}
# Introduction

Employees, according to @IBM_Developer_Challenge_2020, are the foundation of any business. Its success is largely determined by the quality of its employees and their ability to stay with the company. Organizations confront a number of issues as a result of staff attrition:

1. Training new personnel is costly in terms of both money and time.
2. Potential to lose experienced employees
3. Productivity impact
4. Profitability impact

Therefore, IBM data scientists created a fictitious data set as a challenge for data scientists. Among the data types are metrics such as education level, job satisfaction, and commute distance. The dataset can be found on the company's GitHub account [@IBM_Data_2019].

# Methodology

The following topics are layed out through out this paper:

1. Linear Models
2. Extending the Linear Model: Non-linearity
3. Extending the Linear Model: Generalised Linear Models
4. Support Vector Machines
5. Neural Networks
6. Optimisation

\newpage
# Data preparation
```{r import-data, echo = FALSE, results = FALSE}
emp_attrition <- read.csv("./data/emp_attrition.csv")
head(emp_attrition)
```

## Data Transformation and Sanity Check

The code for this part is left out from the PDF due to its length...
```{r formatting-data, echo = FALSE, results = FALSE}
# Age
summary(emp_attrition$Age)

# Attrition
emp_attrition$Attrition <- as.factor(emp_attrition$Attrition)
unique(emp_attrition$Attrition)

# BusinessTravel
emp_attrition$BusinessTravel <- as.factor(emp_attrition$BusinessTravel)
levels(emp_attrition$BusinessTravel) <- c("Rarely", "Frequently", "None")
emp_attrition$BusinessTravel <- relevel(emp_attrition$BusinessTravel, ref = "None")
unique(emp_attrition$BusinessTravel)

# DailyRate
summary(emp_attrition$DailyRate)

# Department
emp_attrition$Department <- as.factor(emp_attrition$Department)
levels(emp_attrition$Department) <- c("Sales", "R&D", "HR")
unique(emp_attrition$Department)

# DistanceFromHome
summary(emp_attrition$DistanceFromHome)

# Education
emp_attrition$Education <- as.factor(emp_attrition$Education)
levels(emp_attrition$Education) <- c("Below College", "College", "Bachelor", "Master", "Doctor")
unique(emp_attrition$Education)

# EducationField
emp_attrition$EducationField <- as.factor(emp_attrition$EducationField)
unique(emp_attrition$EducationField)

# EmployeeCount
unique(emp_attrition$EmployeeCount) # represents headcount which for all employee's in this dataset 1

# EmployeeNumber
summary(emp_attrition$EmployeeNumber) # internal employee id

# EnvironmentSatisfaction
emp_attrition$EnvironmentSatisfaction <- as.factor(emp_attrition$EnvironmentSatisfaction)
levels(emp_attrition$EnvironmentSatisfaction) <- c("Low", "Medium", "High", "Very High")
unique(emp_attrition$EnvironmentSatisfaction)

# Gender
emp_attrition$Gender <- as.factor(emp_attrition$Gender)
unique(emp_attrition$Gender)

# HourlyRate
summary(emp_attrition$HourlyRate)

# JobInvolvement
emp_attrition$JobInvolvement <- as.factor(emp_attrition$JobInvolvement)
levels(emp_attrition$JobInvolvement) <- c("Low", "Medium", "High", "Very High")
unique(emp_attrition$JobInvolvement)

# JobLevel
emp_attrition$JobLevel <- as.factor(emp_attrition$JobLevel)
unique(emp_attrition$JobLevel)

# JobRole
emp_attrition$JobRole <- as.factor(emp_attrition$JobRole)
unique(emp_attrition$JobRole)

# JobSatisfaction
emp_attrition$JobSatisfaction <- as.factor(emp_attrition$JobSatisfaction)
levels(emp_attrition$JobSatisfaction) <- c("Low", "Medium", "High", "Very High")
unique(emp_attrition$JobSatisfaction)

# MaritalStatus
emp_attrition$MaritalStatus <- as.factor(emp_attrition$MaritalStatus)
unique(emp_attrition$MaritalStatus)

# MonthlyIncome
summary(emp_attrition$MonthlyIncome)

# MonthlyRate
summary(emp_attrition$MonthlyRate)

# NumCompaniesWorked
unique(emp_attrition$NumCompaniesWorked)

# Over18
unique(emp_attrition$Over18) # all employee's are above 18

# OverTime
emp_attrition$OverTime <- as.factor(emp_attrition$OverTime)
unique(emp_attrition$OverTime)

# PercentSalaryHike
summary(emp_attrition$PercentSalaryHike)

# PerformanceRating
emp_attrition$PerformanceRating <- as.factor(emp_attrition$PerformanceRating)
levels(emp_attrition$PerformanceRating) <- c("Excellent", "Outstanding")
unique(emp_attrition$PerformanceRating) # only employee's who perform 3 or 4

# RelationshipSatisfaction
emp_attrition$RelationshipSatisfaction <- as.factor(emp_attrition$RelationshipSatisfaction)
levels(emp_attrition$RelationshipSatisfaction) <- c("Low", "Medium", "High", "Very High")
unique(emp_attrition$RelationshipSatisfaction)

# StandardHours
unique(emp_attrition$StandardHours) # the StandardHours for all employee's is 80, after check this means that this data has a 9/80 work schedule. Hence, employees work 80 hours in 9 days. So not a standard as 5/42 as in switzerland..

# StockOptionLevel
emp_attrition$StockOptionLevel <- as.factor(emp_attrition$StockOptionLevel)
unique(emp_attrition$StockOptionLevel)

# TotalWorkingYears
summary(emp_attrition$TotalWorkingYears)

# TrainingTimesLastYear
unique(emp_attrition$TrainingTimesLastYear)

# WorkLifeBalance
emp_attrition$WorkLifeBalance <- as.factor(emp_attrition$WorkLifeBalance)
levels(emp_attrition$WorkLifeBalance) <- c("Bad", "Good", "Better", "Best")
unique(emp_attrition$WorkLifeBalance)

# YearsAtCompany
summary(emp_attrition$YearsAtCompany)

# YearsInCurrentRole
summary(emp_attrition$YearsInCurrentRole)

# YearsSinceLastPromotion
summary(emp_attrition$YearsSinceLastPromotion)

# YearsWithCurrManager
summary(emp_attrition$YearsWithCurrManager)

labels(emp_attrition) <- colnames(emp_attrition)
labels(emp_attrition, which = c("Age", "BusinessTravel", "DailyRate", "DistanceFromHome", "EducationField", "EmployeeNumber", "EnvironmentSatisfaction", "HourlyRate", "JobInvolvement", "JobLevel", "JobRole", "JobSatisfaction", "MaritalStatus", "MonthlyIncome", "MonthlyRate", "NumCompaniesWorked", "OverTime", "PercentSalaryHike", "PerformanceRating", "RelationshipSatisfaction", "StockOptionLevel", "TotalWorkingYears", "TrainingTimesLastYear", "WorkLifeBalance", "YearsAtCompany", "YearsInCurrentRole", "YearsSinceLastPromotion", "YearsWithCurrManager")) <- c("Age (years)", "Business Travel", "Daily Rate (salary per day)", "Distance From Home (1-29)", "Education Field", "Employee ID", "Environment Satisfaction", "Hourly Rate (salary per hour)", "Job Involvement", "Job Level (internal company hierachy 1-5)", "Job Role", "Job Satisfaction", "Marital Status", "Monthly Income", "Monthly Rate (salary per month)", "Number of Companies worked before starting this position", "has done over time", "% Salary Hike", "Performance Rating", "Relationship Satisfaction", "Stock Option Level (number of stocks an employee owns from 0-3)", "Total Working Years", "Number Of Trainings Done Last Year", "Work Life Balance", "Number Of Years At Company", "Number of Years In Current Role", "Number Of Years Since Last Promotion", "Number Of Years With Current Manager")
```

## Data Cleaning

```{r data-cleaning}
emp_attrition <- emp_attrition %>% select (-c(EmployeeCount, StandardHours, Over18))
```

- EmployeeCount (represents the head count which is 1 for all employee, hence drop this)
- StandardHours (StandardHours for all employee's is 80, therefore this data has a 9/80 work schedule. Hence, employees work 80 hours in 9 days. So not a standard as 5/42 as in switzerland, we drop this)
- Over18 (all employee's are 18 or above and it's capured in age, hence drop this variable)

## Missing Value Check
```{r check-for-missing-values, echo = TRUE, results = FALSE}
# Do we have any missing values?
sapply(emp_attrition, function(x) all(is.na(x) | x == '' ))
```
There are no missing values in this dataset.

\newpage
## Overview of Dataset


```{r numeric-variable-table, echo = FALSE, message = FALSE, results='asis'}
kable(summarize(emp_attrition, type = "numeric"), 
      caption = "Summary Numeric Variables", format = "latex", booktabs = TRUE) %>%
  kable_styling(latex_options = "hold_position")
```

```{r factor-variable-table, echo = FALSE, message = FALSE, results='asis'}
summary.factors <- papeR::summarize(emp_attrition, type = "factor")
kable(list(summary.factors[1:33,], summary.factors[34:66,]), 
      caption = "Summary Factor Variables", format = "latex", booktabs = TRUE, row.names = FALSE) %>%
  kable_styling(latex_options = "hold_position", font_size = 5.8)
```

\newpage
# Exploration

\newpage
# Linear Regression
```{r}
lm.emp_attrition <- lm(as.numeric(Attrition) ~ . , data = emp_attrition)

lm.summary <- summary(lm.emp_attrition)
lm.drop1 <- drop1(lm.emp_attrition, test = "F")
```

```{r significant-variable-table, echo = FALSE, message = FALSE, results='asis'}
significance.table <- cbind(c("Age", "BusinessTravel", "DistanceFromHome", "EducationField", "EnvironmentSatisfaction", "JobInvolvement", "JobLevel", "JobRole", "JobSatisfaction", "NumCompaniesWorked", "OverTime", "RelationshipSatisfaction", "StockOptionLevel", "TrainingTimesLastYear", "WorkLifeBalance", "YearsAtCompany", "YearsInCurrentRole", "YearsSinceLastPromotion", "YearsWithCurrManager"))
colnames(significance.table) <- c("Drop1")
significance.table <- as.data.frame(significance.table)

lm.drop1.pr <- c()
for (name in significance.table$Drop1) {
  lm.drop1.pr[length(lm.drop1.pr) + 1] <- lm.drop1[name,]$`Pr(>F)`
}
significance.table <- cbind(significance.table, lm.drop1.pr, c("Age", "BusinessTravel", "DistanceFromHome", "EnvironmentSatisfaction", "JobSatisfaction", "NumCompaniesWorked", "OverTime", "RelationshipSatisfaction", "StockOptionLevel", "WorkLifeBalance", "YearsInCurrentRole", "YearsSinceLastPromotion", "YearsWithCurrManager", NA, NA, NA, NA, NA, NA))
significance.table <- as.data.frame(significance.table)
colnames(significance.table) <- c("Drop1", "Pr(>|t|)", "Summary")

kable(significance.table, 
      caption = "Summary Significant Variables", format = "latex", booktabs = TRUE) %>%
  kable_styling(latex_options = "hold_position")
```


These are the dependent variables which are significant or weakly significant in Drop1, but not in the Summary statistics.

```{r}
significance.table$Drop1[!(significance.table$Drop1 %in% significance.table$Summary)]
```

TODO: Check this?

```{r}
lm.attrition <- lm(as.numeric(Attrition) ~ Age + BusinessTravel + DistanceFromHome + 
                     EducationField + EnvironmentSatisfaction + JobInvolvement + 
                     JobLevel + JobRole + JobSatisfaction + NumCompaniesWorked + 
                     OverTime + RelationshipSatisfaction + StockOptionLevel + 
                     TrainingTimesLastYear + WorkLifeBalance + YearsAtCompany + 
                     YearsInCurrentRole + YearsSinceLastPromotion + 
                     YearsWithCurrManager, data = emp_attrition)
```

A first simple linear regression model with and $R^2$ around 30%. However, it doesn't really make sense to use this model with Attrition being True or False.


\newpage
## Model Development (Interactions)
```{r significant-interaction-process, echo = FALSE, results = FALSE, message = FALSE, eval = FALSE}

# Age
lm.attrition.interactions.age <- update(lm.attrition, . ~ . + 
                                          Age:BusinessTravel + 
                                          Age:DistanceFromHome +
                                          Age:EducationField + 
                                          Age:EnvironmentSatisfaction + 
                                          Age:JobInvolvement +
                                          Age:JobLevel +
                                          Age:JobRole +
                                          Age:JobSatisfaction +
                                          Age:NumCompaniesWorked +
                                          Age:OverTime +
                                          Age:RelationshipSatisfaction +
                                          Age:StockOptionLevel +
                                          Age:TrainingTimesLastYear +
                                          Age:WorkLifeBalance +
                                          Age:YearsAtCompany +
                                          Age:YearsInCurrentRole +
                                          Age:YearsSinceLastPromotion +
                                          Age:YearsWithCurrManager) 
drop1(lm.attrition.interactions.age, test = "F")

lm.attrition.interactions <- update(lm.attrition, . ~ . + Age:JobSatisfaction + 
                                      Age:OverTime + Age:StockOptionLevel)

# BusinessTravel
lm.attrition.interactions.BusinessTravel <- update(lm.attrition.interactions, . ~ . + 
                                          BusinessTravel:DistanceFromHome +
                                          BusinessTravel:EducationField + 
                                          BusinessTravel:EnvironmentSatisfaction + 
                                          BusinessTravel:JobInvolvement +
                                          BusinessTravel:JobLevel +
                                          BusinessTravel:JobRole +
                                          BusinessTravel:JobSatisfaction +
                                          BusinessTravel:NumCompaniesWorked +
                                          BusinessTravel:OverTime +
                                          BusinessTravel:RelationshipSatisfaction +
                                          BusinessTravel:StockOptionLevel +
                                          BusinessTravel:TrainingTimesLastYear +
                                          BusinessTravel:WorkLifeBalance +
                                          BusinessTravel:YearsAtCompany +
                                          BusinessTravel:YearsInCurrentRole +
                                          BusinessTravel:YearsSinceLastPromotion +
                                          BusinessTravel:YearsWithCurrManager) 
drop1(lm.attrition.interactions.BusinessTravel, test = "F")

lm.attrition.interactions <- update(lm.attrition.interactions, . ~ . + 
                                      BusinessTravel:JobSatisfaction + 
                                      BusinessTravel:YearsAtCompany)

# DistanceFromHome
lm.attrition.interactions.DistanceFromHome <- update(lm.attrition.interactions, . ~ . + 
                                          DistanceFromHome:EducationField + 
                                          DistanceFromHome:EnvironmentSatisfaction + 
                                          DistanceFromHome:JobInvolvement +
                                          DistanceFromHome:JobLevel +
                                          DistanceFromHome:JobRole +
                                          DistanceFromHome:JobSatisfaction +
                                          DistanceFromHome:NumCompaniesWorked +
                                          DistanceFromHome:OverTime +
                                          DistanceFromHome:RelationshipSatisfaction +
                                          DistanceFromHome:StockOptionLevel +
                                          DistanceFromHome:TrainingTimesLastYear +
                                          DistanceFromHome:WorkLifeBalance +
                                          DistanceFromHome:YearsAtCompany +
                                          DistanceFromHome:YearsInCurrentRole +
                                          DistanceFromHome:YearsSinceLastPromotion +
                                          DistanceFromHome:YearsWithCurrManager) 
drop1(lm.attrition.interactions.DistanceFromHome, test = "F")

lm.attrition.interactions <- update(lm.attrition.interactions, . ~ . + 
                                      DistanceFromHome:OverTime)

# EducationField
lm.attrition.interactions.EducationField <- update(lm.attrition.interactions, . ~ . + 
                                          EducationField:EnvironmentSatisfaction + 
                                          EducationField:JobInvolvement +
                                          EducationField:JobLevel +
                                          EducationField:JobRole +
                                          EducationField:JobSatisfaction +
                                          EducationField:NumCompaniesWorked +
                                          EducationField:OverTime +
                                          EducationField:RelationshipSatisfaction +
                                          EducationField:StockOptionLevel +
                                          EducationField:TrainingTimesLastYear +
                                          EducationField:WorkLifeBalance +
                                          EducationField:YearsAtCompany +
                                          EducationField:YearsInCurrentRole +
                                          EducationField:YearsSinceLastPromotion +
                                          EducationField:YearsWithCurrManager) 
drop1(lm.attrition.interactions.EducationField, test = "F")

lm.attrition.interactions <- update(lm.attrition.interactions, . ~ . + 
                                      EducationField:JobSatisfaction)

# EnvironmentSatisfaction
lm.attrition.interactions.EnvironmentSatisfaction <- update(lm.attrition.interactions, . ~ . + 
                                          EnvironmentSatisfaction:JobInvolvement +
                                          EnvironmentSatisfaction:JobLevel +
                                          EnvironmentSatisfaction:JobRole +
                                          EnvironmentSatisfaction:JobSatisfaction +
                                          EnvironmentSatisfaction:NumCompaniesWorked +
                                          EnvironmentSatisfaction:OverTime +
                                          EnvironmentSatisfaction:RelationshipSatisfaction +
                                          EnvironmentSatisfaction:StockOptionLevel +
                                          EnvironmentSatisfaction:TrainingTimesLastYear +
                                          EnvironmentSatisfaction:WorkLifeBalance +
                                          EnvironmentSatisfaction:YearsAtCompany +
                                          EnvironmentSatisfaction:YearsInCurrentRole +
                                          EnvironmentSatisfaction:YearsSinceLastPromotion +
                                          EnvironmentSatisfaction:YearsWithCurrManager) 
drop1(lm.attrition.interactions.EnvironmentSatisfaction, test = "F")

lm.attrition.interactions <- update(lm.attrition.interactions, . ~ . + 
                                      EnvironmentSatisfaction:JobInvolvement +
                                      EnvironmentSatisfaction:WorkLifeBalance)

# JobInvolvement
lm.attrition.interactions.JobInvolvement <- update(lm.attrition.interactions, . ~ . + 
                                          JobInvolvement:JobLevel +
                                          JobInvolvement:JobRole +
                                          JobInvolvement:JobSatisfaction +
                                          JobInvolvement:NumCompaniesWorked +
                                          JobInvolvement:OverTime +
                                          JobInvolvement:RelationshipSatisfaction +
                                          JobInvolvement:StockOptionLevel +
                                          JobInvolvement:TrainingTimesLastYear +
                                          JobInvolvement:WorkLifeBalance +
                                          JobInvolvement:YearsAtCompany +
                                          JobInvolvement:YearsInCurrentRole +
                                          JobInvolvement:YearsSinceLastPromotion +
                                          JobInvolvement:YearsWithCurrManager) 
drop1(lm.attrition.interactions.JobInvolvement, test = "F")

# JobLevel
lm.attrition.interactions.JobLevel <- update(lm.attrition.interactions, . ~ . + 
                                          JobLevel:JobRole +
                                          JobLevel:JobSatisfaction +
                                          JobLevel:NumCompaniesWorked +
                                          JobLevel:OverTime +
                                          JobLevel:RelationshipSatisfaction +
                                          JobLevel:StockOptionLevel +
                                          JobLevel:TrainingTimesLastYear +
                                          JobLevel:WorkLifeBalance +
                                          JobLevel:YearsAtCompany +
                                          JobLevel:YearsInCurrentRole +
                                          JobLevel:YearsSinceLastPromotion +
                                          JobLevel:YearsWithCurrManager) 
drop1(lm.attrition.interactions.JobLevel, test = "F")

lm.attrition.interactions <- update(lm.attrition.interactions, . ~ . + 
                                      JobLevel:OverTime)

# JobRole
lm.attrition.interactions.JobRole <- update(lm.attrition.interactions, . ~ . + 
                                          JobRole:JobSatisfaction +
                                          JobRole:NumCompaniesWorked +
                                          JobRole:OverTime +
                                          JobRole:RelationshipSatisfaction +
                                          JobRole:StockOptionLevel +
                                          JobRole:TrainingTimesLastYear +
                                          JobRole:WorkLifeBalance +
                                          JobRole:YearsAtCompany +
                                          JobRole:YearsInCurrentRole +
                                          JobRole:YearsSinceLastPromotion +
                                          JobRole:YearsWithCurrManager) 
drop1(lm.attrition.interactions.JobRole, test = "F")

lm.attrition.interactions <- update(lm.attrition.interactions, . ~ . + 
                                      JobRole:OverTime +
                                      JobRole:RelationshipSatisfaction +
                                      JobRole:WorkLifeBalance +
                                      JobRole:YearsInCurrentRole)

# JobSatisfaction
lm.attrition.interactions.JobSatisfaction <- update(lm.attrition.interactions, . ~ . + 
                                          JobSatisfaction:NumCompaniesWorked +
                                          JobSatisfaction:OverTime +
                                          JobSatisfaction:RelationshipSatisfaction +
                                          JobSatisfaction:StockOptionLevel +
                                          JobSatisfaction:TrainingTimesLastYear +
                                          JobSatisfaction:WorkLifeBalance +
                                          JobSatisfaction:YearsAtCompany +
                                          JobSatisfaction:YearsInCurrentRole +
                                          JobSatisfaction:YearsSinceLastPromotion +
                                          JobSatisfaction:YearsWithCurrManager) 
drop1(lm.attrition.interactions.JobSatisfaction, test = "F")

# NumCompaniesWorked
lm.attrition.interactions.NumCompaniesWorked <- update(lm.attrition.interactions, . ~ . + 
                                          NumCompaniesWorked:OverTime +
                                          NumCompaniesWorked:RelationshipSatisfaction +
                                          NumCompaniesWorked:StockOptionLevel +
                                          NumCompaniesWorked:TrainingTimesLastYear +
                                          NumCompaniesWorked:WorkLifeBalance +
                                          NumCompaniesWorked:YearsAtCompany +
                                          NumCompaniesWorked:YearsInCurrentRole +
                                          NumCompaniesWorked:YearsSinceLastPromotion +
                                          NumCompaniesWorked:YearsWithCurrManager) 
drop1(lm.attrition.interactions.NumCompaniesWorked, test = "F")

lm.attrition.interactions <- update(lm.attrition.interactions, . ~ . + 
                                      NumCompaniesWorked:OverTime +
                                      NumCompaniesWorked:StockOptionLevel)

# OverTime
lm.attrition.interactions.OverTime <- update(lm.attrition.interactions, . ~ . + 
                                          OverTime:RelationshipSatisfaction +
                                          OverTime:StockOptionLevel +
                                          OverTime:TrainingTimesLastYear +
                                          OverTime:WorkLifeBalance +
                                          OverTime:YearsAtCompany +
                                          OverTime:YearsInCurrentRole +
                                          OverTime:YearsSinceLastPromotion +
                                          OverTime:YearsWithCurrManager) 
drop1(lm.attrition.interactions.OverTime, test = "F")

lm.attrition.interactions <- update(lm.attrition.interactions, . ~ . + 
                                      OverTime:RelationshipSatisfaction +
                                      OverTime:StockOptionLevel)

# RelationshipSatisfaction
lm.attrition.interactions.RelationshipSatisfaction <- update(lm.attrition.interactions, . ~ . + 
                                          RelationshipSatisfaction:StockOptionLevel +
                                          RelationshipSatisfaction:TrainingTimesLastYear +
                                          RelationshipSatisfaction:WorkLifeBalance +
                                          RelationshipSatisfaction:YearsAtCompany +
                                          RelationshipSatisfaction:YearsInCurrentRole +
                                          RelationshipSatisfaction:YearsSinceLastPromotion +
                                          RelationshipSatisfaction:YearsWithCurrManager) 
drop1(lm.attrition.interactions.RelationshipSatisfaction, test = "F")

# StockOptionLevel
lm.attrition.interactions.StockOptionLevel <- update(lm.attrition.interactions, . ~ . + 
                                          StockOptionLevel:TrainingTimesLastYear +
                                          StockOptionLevel:WorkLifeBalance +
                                          StockOptionLevel:YearsAtCompany +
                                          StockOptionLevel:YearsInCurrentRole +
                                          StockOptionLevel:YearsSinceLastPromotion +
                                          StockOptionLevel:YearsWithCurrManager) 
drop1(lm.attrition.interactions.StockOptionLevel, test = "F")

lm.attrition.interactions <- update(lm.attrition.interactions, . ~ . + 
                                      StockOptionLevel:YearsSinceLastPromotion)

# StockOptionLevel
lm.attrition.interactions.TrainingTimesLastYear <- update(lm.attrition.interactions, . ~ . + 
                                          TrainingTimesLastYear:WorkLifeBalance +
                                          TrainingTimesLastYear:YearsAtCompany +
                                          TrainingTimesLastYear:YearsInCurrentRole +
                                          TrainingTimesLastYear:YearsSinceLastPromotion +
                                          TrainingTimesLastYear:YearsWithCurrManager) 
drop1(lm.attrition.interactions.TrainingTimesLastYear, test = "F")

lm.attrition.interactions <- update(lm.attrition.interactions, . ~ . + 
                                      TrainingTimesLastYear:YearsSinceLastPromotion)

# WorkLifeBalance
lm.attrition.interactions.WorkLifeBalance <- update(lm.attrition.interactions, . ~ . + 
                                          WorkLifeBalance:YearsAtCompany +
                                          WorkLifeBalance:YearsInCurrentRole +
                                          WorkLifeBalance:YearsSinceLastPromotion +
                                          WorkLifeBalance:YearsWithCurrManager) 
drop1(lm.attrition.interactions.WorkLifeBalance, test = "F")

lm.attrition.interactions <- update(lm.attrition.interactions, . ~ . + 
                                      WorkLifeBalance:YearsAtCompany +
                                      WorkLifeBalance:YearsSinceLastPromotion +
                                      WorkLifeBalance:YearsWithCurrManager)

# YearsAtCompany
lm.attrition.interactions.YearsAtCompany <- update(lm.attrition.interactions, . ~ . + 
                                          YearsAtCompany:YearsInCurrentRole +
                                          YearsAtCompany:YearsSinceLastPromotion +
                                          YearsAtCompany:YearsWithCurrManager) 
drop1(lm.attrition.interactions.YearsAtCompany, test = "F")

# YearsInCurrentRole
lm.attrition.interactions.YearsInCurrentRole <- update(lm.attrition.interactions, . ~ . + 
                                          YearsInCurrentRole:YearsSinceLastPromotion +
                                          YearsInCurrentRole:YearsWithCurrManager) 
drop1(lm.attrition.interactions.YearsInCurrentRole, test = "F")

# YearsSinceLastPromotion
lm.attrition.interactions.YearsSinceLastPromotion <- update(lm.attrition.interactions, . ~ . + 
                                          YearsSinceLastPromotion:YearsWithCurrManager) 
drop1(lm.attrition.interactions.YearsSinceLastPromotion, test = "F")


# CleanUp
lm.attrition.interactions <- update(lm.attrition.interactions, . ~ . - 
                                      Age:OverTime -
                                      BusinessTravel:JobSatisfaction - 
                                      EducationField:JobSatisfaction - 
                                      JobRole:RelationshipSatisfaction -
                                      StockOptionLevel:YearsSinceLastPromotion -
                                      TrainingTimesLastYear:YearsSinceLastPromotion -
                                      JobRole:YearsInCurrentRole -
                                      WorkLifeBalance:YearsAtCompany -
                                      WorkLifeBalance:YearsWithCurrManager)
drop1(lm.attrition.interactions, test="F")

```

```{r significant-interactions, echo = TRUE, results = FALSE, message = FALSE}
lm.attrition.interactions <- lm(as.numeric(Attrition) ~ Age + BusinessTravel + 
    DistanceFromHome + EducationField + EnvironmentSatisfaction + JobInvolvement + 
    JobLevel + JobRole + JobSatisfaction + NumCompaniesWorked + OverTime + 
    RelationshipSatisfaction + StockOptionLevel + TrainingTimesLastYear + 
    WorkLifeBalance + YearsAtCompany + YearsInCurrentRole + YearsSinceLastPromotion + 
    YearsWithCurrManager + 
    Age:JobSatisfaction + Age:StockOptionLevel + BusinessTravel:YearsAtCompany + 
    DistanceFromHome:OverTime + EnvironmentSatisfaction:JobInvolvement + 
    EnvironmentSatisfaction:WorkLifeBalance + JobLevel:OverTime + 
    JobRole:OverTime + JobRole:WorkLifeBalance + NumCompaniesWorked:OverTime + 
    NumCompaniesWorked:StockOptionLevel + OverTime:RelationshipSatisfaction + 
    OverTime:StockOptionLevel + WorkLifeBalance:YearsSinceLastPromotion, 
    data = emp_attrition)

drop1(lm.attrition.interactions, test="F")
```


# Extending the Linear Model

## Generalised Linear Models
```{r generalised-additive-model}
glm.attrition <- glm(Attrition ~ Age + BusinessTravel + 
    DistanceFromHome + EducationField + EnvironmentSatisfaction + JobInvolvement + 
    JobLevel + JobRole + JobSatisfaction + NumCompaniesWorked + OverTime + 
    RelationshipSatisfaction + StockOptionLevel + TrainingTimesLastYear + 
    WorkLifeBalance + YearsAtCompany + YearsInCurrentRole + YearsSinceLastPromotion + 
    YearsWithCurrManager + 
    Age:JobSatisfaction + Age:StockOptionLevel + BusinessTravel:YearsAtCompany + 
    DistanceFromHome:OverTime + EnvironmentSatisfaction:JobInvolvement + 
    EnvironmentSatisfaction:WorkLifeBalance + JobLevel:OverTime + 
    JobRole:OverTime + JobRole:WorkLifeBalance + NumCompaniesWorked:OverTime + 
    NumCompaniesWorked:StockOptionLevel + OverTime:RelationshipSatisfaction + 
    OverTime:StockOptionLevel + WorkLifeBalance:YearsSinceLastPromotion, 
    data = emp_attrition, family = binomial)

#confint(glm.attrition, level = 0.95)
#summary(glm.attrition)
#drop1(glm.attrition, test = "F")
```

### Age

```{r glm-plots-age, fig.show='hold', out.width = "33%", warning=FALSE, message=FALSE, echo = FALSE }
ggplot(emp_attrition, aes(Age, glm.attrition$fitted.values)) +
  geom_point(alpha = 0.15) +
  geom_smooth(method = "gam", method.args = list(family = "quasibinomial")) +
  labs(title="Attrition ~ Age", x="Age", y="Probability of Attrition")

ggplot(emp_attrition, aes(Age, glm.attrition$fitted.values, color = JobSatisfaction)) +
  geom_point(alpha = 0.15) +
  geom_smooth(method = "gam", method.args = list(family = "quasibinomial")) +
  labs(title="Attrition ~ Age", x="Age", y="Probability of Attrition", color="Job Satisfaction")

ggplot(emp_attrition, aes(Age, glm.attrition$fitted.values, color = StockOptionLevel)) +
  geom_point(alpha = 0.15) +
  geom_smooth(method = "gam", method.args = list(family = "quasibinomial")) +
  labs(title="Attrition ~ Age", x="Age", y="Probability of Attrition", color="Stock Option Level")
```

### Business Travel

```{r glm-plots-businessTravel, fig.show='hold', out.width = "50%", warning=FALSE, message=FALSE, echo = FALSE }
ggplot(emp_attrition, aes(BusinessTravel, glm.attrition$fitted.values, color = BusinessTravel)) +
  geom_boxplot(show.legend = FALSE) +
  geom_rug(sides = "b", position = "jitter", alpha = 0.2, show.legend = FALSE) +
  labs(title="Attrition ~ Business Travel", x="Business Travel", y="Probability of Attrition")

ggplot(emp_attrition, aes(YearsAtCompany, glm.attrition$fitted.values, color = BusinessTravel)) +
  geom_boxplot(show.legend = FALSE) +
  facet_wrap(~BusinessTravel) +
  labs(title="Attrition ~ Business Travel", x="Years At Company", y="Probability of Attrition")
```

### Distance From Home

```{r glm-plots-distanceFromHome, fig.show='hold', out.width = "50%", warning=FALSE, message=FALSE, echo = FALSE }
ggplot(emp_attrition, aes(DistanceFromHome, glm.attrition$fitted.values)) +
  geom_point(alpha = 0.15) +
  geom_smooth(method = "gam", method.args = list(family = "quasibinomial")) +
  labs(title="Attrition ~ DistanceFromHome", x="Distance From Home", y="Probability of Attrition")

ggplot(emp_attrition, aes(DistanceFromHome, glm.attrition$fitted.values, color = OverTime)) +
  geom_point(alpha = 0.15) +
  geom_smooth(method = "gam", method.args = list(family = "quasibinomial")) +
  labs(title="Attrition ~ DistanceFromHome", x="Distance From Home", y="Probability of Attrition", color="Over Time")
```

### Education Field

```{r glm-plots-educationField, fig.show='hold', out.width = "50%", warning=FALSE, message=FALSE, echo = FALSE}
ggplot(emp_attrition, aes(EducationField, glm.attrition$fitted.values, color = EducationField)) +
  geom_boxplot(show.legend = FALSE) +
  geom_rug(sides = "b", position = "jitter", alpha = 0.2, show.legend = FALSE) +
  labs(title="Attrition ~ Education Field", x="Education Field", y="Probability of Attrition")
```

### Environment Satisfaction

```{r glm-plots-EnvironmentSatisfaction, fig.show='hold', out.width = "50%", warning=FALSE, message=FALSE, echo = FALSE}
ggplot(emp_attrition, aes(EnvironmentSatisfaction, glm.attrition$fitted.values, color = EnvironmentSatisfaction)) +
  geom_boxplot(show.legend = FALSE) +
  geom_rug(sides = "b", position = "jitter", alpha = 0.2, show.legend = FALSE) +
  labs(title="Attrition ~ Environment Satisfaction", x="Environment Satisfaction", y="Probability of Attrition")

ggplot(emp_attrition, aes(EnvironmentSatisfaction, glm.attrition$fitted.values, color = JobInvolvement)) +
  geom_boxplot(show.legend = TRUE) +
  labs(title="Attrition ~ Environment Satisfaction", x="Environment Satisfaction", y="Probability of Attrition", color="Job Involvement")

# EnvironmentSatisfaction:WorkLifeBalance
```

\newpage
# Conclusion

\newpage
# Session Information {-}

```{r session-info}
sessionInfo()
```

\newpage
# References

