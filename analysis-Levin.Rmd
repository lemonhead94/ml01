---
output:
  bookdown::pdf_document2:
    includes:
      in_header: latex/preamble.tex
      before_body: latex/titlepage.tex
    pandoc_args:
    - --csl
    - references/apa.csl
  bookdown::html_document2:
    pandoc_args:
    - --csl
    - references/apa.csl
  bookdown::word_document2:
    pandoc_args:
    - --csl
    - references/apa.csl
toc-title: Table of Contents
bibliography: references/references.bib
link-citations: yes
header-includes:
- \usepackage{fancyhdr}
- \pagestyle{fancy}
- \renewcommand{\headrulewidth}{0pt}
- \fancyfoot[C]{}
- \fancyfoot[R]{\thepage}
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, messages = FALSE)
packages <- c("bookdown", "dplyr", "ggplot2", "papeR", "kableExtra", "mgcv", 
              "rsample", "multcomp", "vip", "magicfor")
package.check <- lapply(packages, FUN = function(x) {
    if (!require(x, character.only = TRUE)) {
        install.packages(x, dependencies = TRUE)
        library(x, character.only = TRUE)
    }
})
```
\fancyhead[LR]{}
\pagenumbering{roman}

\newpage
\cleardoublepage
\pagenumbering{arabic}
\fancyhead[L]{Employee Attrition Model}
\fancyhead[R]{Machine Learning I}
# Introduction

Employees, according to @IBM_Developer_Challenge_2020, are the foundation of any business. Its success is largely determined by the quality of its employees and their ability to stay with the company. Organizations confront a number of issues as a result of staff attrition:

1. Training new personnel is costly in terms of both money and time.
2. Potential to lose experienced employees
3. Productivity impact
4. Profitability impact

Therefore, IBM data scientists created a fictitious data set as a challenge for data scientists. Among the data types are metrics such as education level, job satisfaction, and commute distance. The dataset can be found on the company's GitHub account [@IBM_Data_2019].

# Methodology

The following topics are layed out through out this paper:

1. Linear Models
2. Extending the Linear Model: Non-linearity
3. Extending the Linear Model: Generalised Linear Models
4. Support Vector Machines
5. Neural Networks
6. Optimisation

\newpage
# Data preparation
```{r import-data, echo = FALSE, results = FALSE}
# Working directory
setwd("~/HSLU/FS_22/Machine_learning/Groupwork/Github")
emp_attrition <- read.csv("emp_attrition.csv")
head(emp_attrition)
```

## Data Transformation and Sanity Check

The code for this part is left out from the PDF due to its length...
```{r formatting-data, echo = FALSE, results = FALSE}
# Age
names(emp_attrition)[names(emp_attrition) == "Ã¯..Age"] <- "Age"
summary(emp_attrition$Age)

# Attrition
emp_attrition$Attrition <- as.factor(emp_attrition$Attrition)
unique(emp_attrition$Attrition)

# BusinessTravel
emp_attrition$BusinessTravel <- as.factor(emp_attrition$BusinessTravel)
levels(emp_attrition$BusinessTravel) <- c("Rarely", "Frequently", "None")
emp_attrition$BusinessTravel <- relevel(emp_attrition$BusinessTravel, ref = "None")
unique(emp_attrition$BusinessTravel)

# DailyRate
summary(emp_attrition$DailyRate)

# Department
emp_attrition$Department <- as.factor(emp_attrition$Department)
levels(emp_attrition$Department) <- c("Sales", "R&D", "HR")
unique(emp_attrition$Department)

# DistanceFromHome
summary(emp_attrition$DistanceFromHome)

# Education
emp_attrition$Education <- as.factor(emp_attrition$Education)
levels(emp_attrition$Education) <- c("Below College", "College", "Bachelor", "Master", "Doctor")
unique(emp_attrition$Education)

# EducationField
emp_attrition$EducationField <- as.factor(emp_attrition$EducationField)
unique(emp_attrition$EducationField)

# EmployeeCount
unique(emp_attrition$EmployeeCount) # represents headcount which for all employee's in this dataset 1

# EmployeeNumber
summary(emp_attrition$EmployeeNumber) # internal employee id

# EnvironmentSatisfaction
emp_attrition$EnvironmentSatisfaction <- as.factor(emp_attrition$EnvironmentSatisfaction)
levels(emp_attrition$EnvironmentSatisfaction) <- c("Low", "Medium", "High", "Very High")
unique(emp_attrition$EnvironmentSatisfaction)

# Gender
emp_attrition$Gender <- as.factor(emp_attrition$Gender)
unique(emp_attrition$Gender)

# HourlyRate
summary(emp_attrition$HourlyRate)

# JobInvolvement
emp_attrition$JobInvolvement <- as.factor(emp_attrition$JobInvolvement)
levels(emp_attrition$JobInvolvement) <- c("Low", "Medium", "High", "Very High")
unique(emp_attrition$JobInvolvement)

# JobLevel
emp_attrition$JobLevel <- as.factor(emp_attrition$JobLevel)
unique(emp_attrition$JobLevel)

# JobRole
emp_attrition$JobRole <- as.factor(emp_attrition$JobRole)
unique(emp_attrition$JobRole)

# JobSatisfaction
emp_attrition$JobSatisfaction <- as.factor(emp_attrition$JobSatisfaction)
levels(emp_attrition$JobSatisfaction) <- c("Low", "Medium", "High", "Very High")
unique(emp_attrition$JobSatisfaction)

# MaritalStatus
emp_attrition$MaritalStatus <- as.factor(emp_attrition$MaritalStatus)
unique(emp_attrition$MaritalStatus)

# MonthlyIncome
summary(emp_attrition$MonthlyIncome)

# MonthlyRate
summary(emp_attrition$MonthlyRate)

# NumCompaniesWorked
unique(emp_attrition$NumCompaniesWorked)

# Over18
unique(emp_attrition$Over18) # all employee's are above 18

# OverTime
emp_attrition$OverTime <- as.factor(emp_attrition$OverTime)
unique(emp_attrition$OverTime)

# PercentSalaryHike
summary(emp_attrition$PercentSalaryHike)

# PerformanceRating
emp_attrition$PerformanceRating <- as.factor(emp_attrition$PerformanceRating)
levels(emp_attrition$PerformanceRating) <- c("Excellent", "Outstanding")
unique(emp_attrition$PerformanceRating) # only employee's who perform 3 or 4

# RelationshipSatisfaction
emp_attrition$RelationshipSatisfaction <- as.factor(emp_attrition$RelationshipSatisfaction)
levels(emp_attrition$RelationshipSatisfaction) <- c("Low", "Medium", "High", "Very High")
unique(emp_attrition$RelationshipSatisfaction)

# StandardHours
unique(emp_attrition$StandardHours) # the StandardHours for all employee's is 80, after check this means that this data has a 9/80 work schedule. Hence, employees work 80 hours in 9 days. So not a standard as 5/42 as in switzerland..

# StockOptionLevel
emp_attrition$StockOptionLevel <- as.factor(emp_attrition$StockOptionLevel)
unique(emp_attrition$StockOptionLevel)

# TotalWorkingYears
summary(emp_attrition$TotalWorkingYears)

# TrainingTimesLastYear
unique(emp_attrition$TrainingTimesLastYear)

# WorkLifeBalance
emp_attrition$WorkLifeBalance <- as.factor(emp_attrition$WorkLifeBalance)
levels(emp_attrition$WorkLifeBalance) <- c("Bad", "Good", "Better", "Best")
unique(emp_attrition$WorkLifeBalance)

# YearsAtCompany
summary(emp_attrition$YearsAtCompany)

# YearsInCurrentRole
summary(emp_attrition$YearsInCurrentRole)

# YearsSinceLastPromotion
summary(emp_attrition$YearsSinceLastPromotion)

# YearsWithCurrManager
summary(emp_attrition$YearsWithCurrManager)

labels(emp_attrition) <- colnames(emp_attrition)
labels(emp_attrition, which = c("Age", "BusinessTravel", "DailyRate", "DistanceFromHome", "EducationField", "EmployeeNumber", "EnvironmentSatisfaction", "HourlyRate", "JobInvolvement", "JobLevel", "JobRole", "JobSatisfaction", "MaritalStatus", "MonthlyIncome", "MonthlyRate", "NumCompaniesWorked", "OverTime", "PercentSalaryHike", "PerformanceRating", "RelationshipSatisfaction", "StockOptionLevel", "TotalWorkingYears", "TrainingTimesLastYear", "WorkLifeBalance", "YearsAtCompany", "YearsInCurrentRole", "YearsSinceLastPromotion", "YearsWithCurrManager")) <- c("Age (years)", "Business Travel", "Daily Rate (salary per day)", "Distance From Home (1-29)", "Education Field", "Employee ID", "Environment Satisfaction", "Hourly Rate (salary per hour)", "Job Involvement", "Job Level (internal company hierachy 1-5)", "Job Role", "Job Satisfaction", "Marital Status", "Monthly Income", "Monthly Rate (salary per month)", "Number of Companies worked before starting this position", "has done over time", "% Salary Hike", "Performance Rating", "Relationship Satisfaction", "Stock Option Level (number of stocks an employee owns from 0-3)", "Total Working Years", "Number Of Trainings Done Last Year", "Work Life Balance", "Number Of Years At Company", "Number of Years In Current Role", "Number Of Years Since Last Promotion", "Number Of Years With Current Manager")
```

## Data Cleaning

```{r data-cleaning}
emp_attrition <- subset(emp_attrition, select = -c(EmployeeCount, StandardHours, Over18))
```

- EmployeeCount (represents the head count which is 1 for all employee, hence drop this)
- StandardHours (StandardHours for all employee's is 80, therefore this data has a 9/80 work schedule. Hence, employees work 80 hours in 9 days. So not a standard as 5/42 as in switzerland, we drop this)
- Over18 (all employee's are 18 or above and it's capured in age, hence drop this variable)

## Missing Value Check
```{r check-for-missing-values, echo = TRUE, results = FALSE}
# Do we have any missing values?
sapply(emp_attrition, function(x) all(is.na(x) | x == '' ))
```
There are no missing values in this dataset.

\newpage
## Overview of Dataset

```{r Overview, echo = TRUE, results = TRUE}
str(emp_attrition)
```

\newpage
# Exploration

## Histograms of variables 
In this section the distributions of the numerical variables are analyzed visually, also
in order to evaluate if a variable needs to be log transformed. Therefore, density histograms 
are displayed for each variable with log transformation(orange) and without transformation(blue).

```{r Dataset in scope, include=FALSE, message=FALSE, warning=FALSE}
# Dataset variables in scope
emp_attrition_scope <- emp_attrition[,c("Attrition", "Age", "BusinessTravel",
                                        "DistanceFromHome", "EnvironmentSatisfaction",
                                        "JobSatisfaction",
                                        "NumCompaniesWorked", "OverTime",
                                        "WorkLifeBalance", "YearsAtCompany",
                                        "YearsSinceLastPromotion",
                                        "YearsWithCurrManager")]

```

```{r Histograms, fig.show="hold", out.width = "33%"}
#Selecting numerical variables / extracting names
emp_attrition_numerical_only <- emp_attrition_scope %>% select_if(is.numeric)
names_numerical <- colnames(emp_attrition_numerical_only)

#Histogram plots loop
for (i in 1:ncol(emp_attrition_numerical_only)) {
  variable <- data.frame(matrix(nrow = 1470, ncol = 1))
  variable[,1] <- emp_attrition_numerical_only[, i]
  hist(variable[,1],
       probability = TRUE, breaks = 25,
       col = "blue", main = names_numerical[i])
  lines(density(variable[,1]), lwd = 2, col = "deeppink3")
  hist(log(variable[,1]), probability = TRUE, breaks = 25,
       col = "orange", main = names_numerical[i])
  lines(density(log(variable[,1])), lwd = 2, col = "deeppink3")
  variable <- data.frame(matrix(nrow = 1470, ncol = 1))
}

```
**Findings Histograms:**
- All variables, expect the variable "Years with current Manager", show some sort
of a right skeewed distribution and might be log transformed.
- The variable "Years with current Manager" seems to display a bimodal distribution
with two peaks, with the second peak showing right skeewedness. For a linear model, the
values of the variable could be split around the value 5 to analyse each peak 
separately, however, this might be most applicable if the residuals of the linear
model also display a bimodal distribution indicating a strong influence of the variable. 
- The variables "distance from home", "number of companies worked" and "years since 
last promotion" do not display a normal distribution after the log transformation.
This will be further considered when building a linear model. 
\newpage

# Training and Test Dataset 
```{r , include=FALSE, message=FALSE, warning=FALSE}
# Create training (80%) and test (20%)
set.seed(111)
emp_attrition_split <- initial_split(emp_attrition_scope, prop = 0.8, strata = "Attrition")
emp_attrition_train <- training(emp_attrition_split)
emp_attrition_test <- testing(emp_attrition_split)
```



\newpage

# Linear Regression
As it does not make sense to fit a Linear Model to a categorical variable such as "attrition" (Levels: Yes/NO), the linear models and also the General Additive Models will be fitted using "years at company" as the dependent variable. We assume that the there is less attrition, the longer the employees work for a company. Therefore, the insight of this chapter might help to fit more complex model to the variable "attrition" in the following chapters, but also indicate what leads employees to stay work longer for an employer. 

## Simple Linear Model
Before performing a linear regression model, the reference level for the factor variables
are set to the level with the greatest n-count. Due to the length of the output, the loop below prints only the factor levels of the first two factor variables.
```{r Linear Regression}
# Setting factor levels # Output n count of factor levels
emp_attrition_factors_only <- emp_attrition_train %>% select_if(is.factor)
names_factor_variables <- colnames(emp_attrition_factors_only)
# Loop through factor variables
magic_for(print, silent = TRUE) # call magic_for()
for (i in 1:ncol(emp_attrition_factors_only)) {
  variable <- names_factor_variables[i]
  factor_levels <- table(emp_attrition_factors_only[,i])
  if (i < 3){ # printing first two iterations
    put(variable, factor_levels)}
  else {next}}

# Setting reference levels to factor with greatest n count if required
emp_attrition_test$EnvironmentSatisfaction <- relevel(emp_attrition_test$
                                                        EnvironmentSatisfaction,
                                                        ref = "High")
emp_attrition_test$JobSatisfaction <- relevel(emp_attrition_test$JobSatisfaction
                                              , ref = "High")
emp_attrition_test$WorkLifeBalance <- relevel(emp_attrition_test$WorkLifeBalance
                                              , ref = "Better")
# Linear model without log transformation
lm.YearsAtCompany.0 <- lm(formula=YearsAtCompany ~ ., data = emp_attrition_test)
lm.summary.0 <- summary(lm.YearsAtCompany.0)
lm.summary.0
```
**Findings LM Model .0:**
- Variables with a significant influence on the dependet variable YearsAtCompany,
according to p-value < 0.05: Age, NumCompaniesWorked, YearsSinceLastPromotion, YearsWithCurrManager
- According to the Adjusted R-squared value the model explain 66.13% of the variance of the dependent
variable.
- The assumed normal distribution does only fit the numeric variable but not to 
the categorical variables when the reference level is allocated automatically.

## Linear Model with Log Transformation

In the next step the independent variables which displayed right skeewedness are log transformed for
a further linear model. As the log transformation did create "Infinity values" from log(0) those values
are changed back to 0. No NaN values are created because there are no negative values in the
transformed variables. Created NaN values due to log transformation would most likely need to be deleted from a dataset if they can not be replaced by a reasonable value. Furthermore, the reference levels have to be set again for the newly created _log dataset.
```{r Log Linear Regression}
# Log transformation of variables that seem to be right skeewed 
emp_attrition_log <- emp_attrition_train
emp_attrition_log["Age"] <- log(emp_attrition_log["Age"]) 
emp_attrition_log["YearsAtCompany"] <- log(emp_attrition_log["YearsAtCompany"])
emp_attrition_log["YearsWithCurrManager"] <- log(emp_attrition_log["YearsWithCurrManager"])  

# Na's / -Inf values check after log transformation # Back to 0
sum(is.na(emp_attrition_log)) # 0
sum(emp_attrition_log == "-Inf") #240
emp_attrition_log[emp_attrition_log == "-Inf"] <- 0


# Setting reference levels to factor with greatest n count if required
emp_attrition_log$EnvironmentSatisfaction <- relevel(emp_attrition_log$EnvironmentSatisfaction,
                                                     ref = "High")
emp_attrition_log$JobSatisfaction <- relevel(emp_attrition_log$JobSatisfaction, ref = "High")
emp_attrition_log$WorkLifeBalance <- relevel(emp_attrition_log$WorkLifeBalance, ref = "Better")

# LM All variables, incl. log transformation
lm.YearsAtCompany.1 <- lm(formula = YearsAtCompany ~ ., data = emp_attrition_log)
lm.summary.1 <- summary(lm.YearsAtCompany.1)
lm.summary.1
```
**Findings LM Models .1 including log-transformation:**
- Variables with a significant influence on the dependet variable YearsAtCompany,
according to p-value < 0.05: Attrition, Age, NumCompaniesWorked, YearsSinceLastPromotion, YearsWithCurrManager
- According to the Adjusted R-squared value, the model explains 71,98% of the variance of the 
dependent variable displaying an increase of 5.85% compared to the previous model without log transformation.
- Interestingly, the Categorical variables, EnvironmentSatisfaction, WorkLifeBalanceGood,
display almost significant p-values for at least one factor level and will be kept for further modelling too. 
- The variable "years with current manager" was log transformed due to the formely 
detected right skeewedness of the second peak, which can be reduced by this procedure. Furthermore, this increases also the adjusted R-Squared value of the model. 
- The variables "distance from home", "number of companies worked" and "years since 
last promotion" are not log transformed because this decreased also the obtained 
Adjusted R-squared value in a trial. 

## Residual Analysis LM Models

**Without log transformation: **
-  Resiudals vs. fitted plot: The spread of residuals seems to be higher for higher fitted values. 
Therefore, the normal distributions should be further questioned. 
- QQ-Plot: The strayed residuals around the tails indicate that they might not 
be normally distributed.
- Density plot: As the residuals are mainly bell shaped, only displaying long
tails, the normal distribution will still be assumed. Nevertheless, additional
models will be fitted going forward. Furthermore, the formerly mentioned binominal
distribution of the variable "Years with current manager" seems not to influence 
the distribution of the residuals heavily. Therefore, the two peaks of the variable
will not be analyzed separately nor will the data of the variable be split between
the peaks. A split of the dataset would of course also have further implications
which can be avoided in this analysis. 

```{r , fig.show="hold", out.width = "33%", echo=FALSE}
# Without log transformation # get list of residuals
lm.YearsAtCompany.0_residuals <- resid(lm.YearsAtCompany.0)
#produce residual vs. fitted plot
plot(fitted(lm.YearsAtCompany.0), lm.YearsAtCompany.0_residuals)
abline(0,0) #add a horizontal line at 0 
#create Q-Q plot for residuals
qqnorm(lm.YearsAtCompany.0_residuals)
qqline(lm.YearsAtCompany.0_residuals)#add a straight diagonal line to the plot
 
#Create density plot of residuals
plot(density(lm.YearsAtCompany.0_residuals))

```
**With log transformation:**
- Residuals vs. fitted plot: The spread of residuals for higher fitted values was reduced compared to the model without log transformation. However, the opposite can be observed for lower fitted values. 
- QQ-Plot: In this plot the residuals seem better distributed but still strayed
for higher values. For lower values the assumption of normal distribution seems less appropriate. 
- Density plot: The bell shape is still somehow given, the length of tail did not  change relatively to the scale. 

```{r, fig.show="hold", out.width = "33%", echo=FALSE}
# With log transformation
# get list of residuals
lm.YearsAtCompany.1_residuals <- resid(lm.YearsAtCompany.1)

#produce residual vs. fitted plot
plot(fitted(lm.YearsAtCompany.1), lm.YearsAtCompany.1_residuals)
abline(0,0) #add a horizontal line at 0 

#create Q-Q plot for residuals
qqnorm(lm.YearsAtCompany.1_residuals)
qqline(lm.YearsAtCompany.1_residuals)#add a straight diagonal line to the plot
 
#Create density plot of residuals
plot(density(lm.YearsAtCompany.1_residuals))

```

## Final Linear Model and Verification

```{r Linear Regression selection, fig.show="hold", out.width = "75%"}
# Significant variables, including categorical variable with at least one factor 
# level close to significance level
lm.YearsAtCompany.2 <- lm(YearsAtCompany ~ Attrition + Age + EnvironmentSatisfaction +
                          NumCompaniesWorked + WorkLifeBalance + 
                          YearsSinceLastPromotion + YearsWithCurrManager,
                          data = emp_attrition_log)
lm.summary.2 <- summary(lm.YearsAtCompany.2)
lm.summary.2

# Variable importance plot
vip(lm.YearsAtCompany.2)
```

**Interpretation:**
- Adjusted R-squared: The model is explaining 71.45% of the variance of the dependent 
variable YearsAtCompany.
- Intercept: YearsAtCompany if all other variables were 0 or at the reference level. 
Given variables such as Age, it is pointless to interpret the intercept in this model. 
Numerical variables (log transformed just as the dependent variable):
- Age: The dependent variable, YearsatCompany, increases by 0.45% years if the Age of an 
employee increases by 1%. If for example a 40 years old and a 44 years old employee 
are compared, the older employee is expected to work 0.45 years longer at the company.
- NumCompaniesWorked: The dependent variable, YearsAtCompany, decreases by 0.01% if the 
independent variable increases by 1%. 
- YearsSinceLastPromotion: The dependent variable, YearsatCompany, increases by 0.17% if 
the independent variable increases by 1%. 
- YearsWithCurrManager The dependent variable, YearsatCompany, increases by 0.756075 if
the independent variable increases by 1%. 
Categorical variables (almost significant factor levels):
- EnvironmentSatisfaction: The dependent variable, YearsAtCompany, decreases by 0.08% if the EnvironmentSatisfaction is "low", compared to the reference level "high".  
- WorkLifeBalance: The dependent variable, YearsatCompany, increases by 0.07% respectively
by 0.08% if the balance is "good" or even "best", compared to the reference level "better".
```{r}
# Strict model based on model .2
lm.YearsAtCompany.3 <- update(lm.YearsAtCompany.2, .~. - EnvironmentSatisfaction 
                              - WorkLifeBalance)
lm.summary.3 <- summary(lm.YearsAtCompany.3)
lm.summary.3

# Comparison
anova(lm.YearsAtCompany.2, lm.YearsAtCompany.3)
```

**Interpretation**
- Only slight decrease of adjusted R-squared compared to the previous model by excluding 3 variables.
- However, when looking at the "Residual Sums of Squares" (RSS) it becomes apparent that the previous model did explain slightly more of the variance of the dependent variable YearsAtCompany. Therefore, the more complex will be investigated further 
in the next section using a General Additive Model. 

```{r Verification LM}
# Verification of model .2 with test data
# Log transformation
emp_attrition_test["Age"] <- log(emp_attrition_test["Age"]) 
emp_attrition_test["YearsAtCompany"] <- log(emp_attrition_test["YearsAtCompany"])
emp_attrition_test["YearsWithCurrManager"] <- log(emp_attrition_test["YearsWithCurrManager"])  
# Na's / -Inf values check after log transformation # Back to 0
sum(is.na(emp_attrition_test)) # 0
sum(emp_attrition_test == "-Inf") #240
emp_attrition_test[emp_attrition_test == "-Inf"] <- 0
# Setting reference levels
emp_attrition_test$EnvironmentSatisfaction <- relevel(emp_attrition_test$
                                                      EnvironmentSatisfaction,
                                                      ref = "High")
emp_attrition_test$WorkLifeBalance <- relevel(emp_attrition_test$WorkLifeBalance,
                                              ref = "Better")
# Fitting Model
lm.YearsAtCompany.test <- update(lm.YearsAtCompany.2, data = emp_attrition_test)
lm.summary.test <- summary(lm.YearsAtCompany.test)
lm.summary.test
```

**Interpretation**

# General Additive Model

Generalised Additive Models (GAMs) are an adaptation that allows us to model non-linear data while maintaining explainability.


```{r}
# Dataset Train
emp_attrition_gam <- emp_attrition_train %>% select_if(is.numeric)
emp_attrition_gam[,7] <- emp_attrition_train["Attrition"]
emp_attrition_gam[,7] <- ifelse(emp_attrition_gam[,7] == "Yes",1,0)
emp_attrition_gam[,8] <- emp_attrition_train["EnvironmentSatisfaction"]
emp_attrition_gam[,9]<- emp_attrition_train["WorkLifeBalance"]
names_variables <- colnames(emp_attrition_gam)
# General Additive Model

```



```{r GAM Exploration YearsAtCompany, fig.show="hold", out.width = "50%"}
# Exploration regarding relationship with dependent variable 
for (i in 1:6) {
  variable <- data.frame(matrix(nrow = 1175, ncol = 2))
  variable[,1] <- emp_attrition_gam[,4]
  variable[,2] <- emp_attrition_gam[,i]
  print(ggplot(data = variable,
          mapping = aes(y = variable[,1],
          x = variable[,2])) +
          geom_point() +
          geom_smooth(method = "gam") +
          ggtitle(names_variables[i]) +
          xlab(names_variables[i]) +
          ylab(names_variables[4]))
}
```
**Interpretation of relationship of YearAtCompany ~ Variable:**
- Age: The relationship might be sligthly quadratic. 
- DistancefromHome: The relationship seems to be constant. 
- NumCompaniesWorked: The relationship seems to be rather complex. 
- TotalWorkingYears: The relationship seems to be rather complex than linear.
- YearsInCurrentRole: The relationship seems to be rather complex than linear.
- YearsWithCurrManager: The relationship seems to be rather complex than linear.

```{r}
# General Additive Model; YearsAtCompany
gam.01 <- gam(YearsAtCompany ~  Attrition +
                                Age +
                                EnvironmentSatisfaction +
                                NumCompaniesWorked +
                                WorkLifeBalance +
                                YearsSinceLastPromotion +
                                YearsWithCurrManager, 
                                data = emp_attrition_gam)

summary(gam.01)
```
# Look at it again 
- no smoother used since Age / Years variables are not continous but rather discrete since they
obviously can not take any value 
- poisson distribution applied since the dependent variable YearsAtCompany can not be negative. 
- R-sq.(adj) =  0.726 / compared to the final lm model (lm.YearsAtCompany.4) this value is lower,
maybe due to the selected log transformation in the lm model, but still close. 
- Using the selectively log transformed data set and a gaussian distribution the outcome of the GAM
Model is identical with the LM model. 

```{r}
# General Additive Model; YearsAtCompany
gam.01 <- gam(YearsAtCompany ~  Attrition +
                                s(Age) +
                                EnvironmentSatisfaction +
                                s(NumCompaniesWorked) +
                                WorkLifeBalance +
                                s(YearsSinceLastPromotion) +
                                s(YearsWithCurrManager), 
                                data = emp_attrition_gam)

summary(gam.01)
```
#Interpretation
- Smoothers increase R-sq.(adj) to 0.747.

\newpage
# Conclusion

\newpage
# Session Information {-}

```{r session-info}
#sessionInfo()
```

\newpage
# References

